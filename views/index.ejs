<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let HOST = location.origin.replace(/^http/, 'ws')
    console.log("wss", HOST)
    let ws = new WebSocket(HOST);
    let el;
    ws.onmessage = (event) => {
      console.log("event", event)
      let result = JSON.parse(event.data)
      console.log('result', result, typeof result );
      let dataX = myChart.data.datasets[0].data
      dataX.push(result.x)
      dataX.shift();
      console.log("dataX", dataX)
      myChart.data.datasets[0].data = dataX;
      setInterval(()=> {
        myChart.update();  
        el = document.getElementById('server-time');
        el.innerHTML = 'Server time: ' + result.x ;
      }, 1000)
      
    };
  </script>
</head>

<body>

  <p id="server-time"></p>
  <div class="chart-container" style="position: relative; height:40vh; width:80vw">
    <canvas id="myChart"></canvas>
</div>
  
  <script>
    
  
    let data = {
      datasets: [
        {
          label: 'My First dataset',
          backgroundColor: 'rgb(255, 99, 132)',
          borderColor: 'rgb(255, 99, 132)',
          data: [0,0,0,0,0,0,0],
        },
        // {
        //   label: 'My Second dataset',
        //   backgroundColor: 'rgb(0, 99, 132)',
        //   borderColor: 'rgb(0, 99, 132)',
        //   data: [10, 6, 15, 42, 14, 32, 20],
        // },
        // {
        //   label: 'My Third dataset',
        //   backgroundColor: 'rgb(255, 99, 0)',
        //   borderColor: 'rgb(0, 99, 132)',
        //   data: [15, 42, 15, 30, 14, 20, 12],
        // },
    ]
    };
  
    let config = {
      type: 'line',
      data: data,
      options: {}
    };
    let myChart = new Chart(
      document.getElementById('myChart'),
      config
    );
  </script>
</body>
</html>
